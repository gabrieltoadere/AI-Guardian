<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Details</title>
    <link rel="stylesheet" href="/AI-Guardian/css/common.css">
    <link rel="stylesheet" href="/AI-Guardian/css/history.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>
    <div class="main-container">
        <button class="back-button" onclick="window.history.back()">
            <i class="fas fa-arrow-left"></i> Back
        </button>
        
        <h1 id="productTitle">Product Details</h1>
        
        <!-- Product Status -->
        <div id="productStatus" class="product-status">
            <i class="fas fa-check-circle"></i>
            <h2>SAFE TO EAT</h2>
            <p>No allergens detected based on your preferences</p>
        </div>
        
        <!-- Product Info -->
        <div class="product-info">
            <img id="productImage" alt="Product Image" class="product-image">
            
            <div class="info-section">
                <h3>Ingredients:</h3>
                <ul id="ingredientsList" class="ingredients-list">
                    <!-- Will be filled by JavaScript -->
                </ul>
            </div>
        </div>
        
        <!-- Alternatives Section   <div id="alternativesSection" class="alternatives-section">
            <h3>Safe Alternatives:</h3>
            <div id="alternativeProducts" class="alternatives-grid">
                 Will be filled by JavaScript 
            </div>
        </div>    -->
        
    </div>

    <script>
        // This would be populated from your database based on the product ID
        // Here's just example data
        document.addEventListener('DOMContentLoaded', async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('id');
            

            console.log("Product ID:", productId); // Debug line
            const response = await fetch('http://localhost:5501/getScan', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ productId }),
            });


            const data = await response.json();


           if (data.length > 0) {
                const productData = data[0]; // Extract the first row from results

                const product = {
                    id: productId,
                    name: productData.name,
                    status: productData.status,
                    image: productData.image,         // Make sure your table has this
                    ingredients: productData.ingredients.split(',') // Assuming it's a comma-separated string
                };

                // Update the page with product data
                document.getElementById('productTitle').textContent = product.name;

                // Fill ingredients
                const ingredientsList = document.getElementById('ingredientsList');
                ingredientsList.innerHTML = '';
                product.ingredients.forEach(item => {
                    const li = document.createElement('li');
                    li.textContent = item.trim();
                    ingredientsList.appendChild(li);
                });

                // Set status
                const statusElement = document.getElementById('productStatus');
                if (product.status === "unsafe") {
                    statusElement.innerHTML = `
                        <i class="fas fa-exclamation-triangle"></i>
                        <h2>BE AWARE!</h2>
                        <p>Contains allergens based on your preferences</p>
                    `;
                    statusElement.className = "product-status unsafe";
                }

                } else {
                    console.error("No product found with that ID.");
                }
        });
    </script>
</body>
</html>